# 图片批量处理工具集

一套完整的图片批量处理工具，包含方向矫正、白边裁剪、内容提取等功能。

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 选择需要的功能

#### 功能一：图片方向自动矫正

- 命令行运行 `python image_rotation_corrector.py`
- 矫正后的图片保存在 `output/` 文件夹
- 需要人工检查的图片在 `output/manual_check/` 文件夹

#### 功能二：裁剪图片白色边缘

```bash
python crop_white_edges.py
```

- 自动检测并裁剪图片周围的白色空白区域
- 保留实际内容部分
- 输出到 `output_cropped/` 文件夹

#### 功能三：图片内容三等分提取

```bash
python split_images.py
```

- 将包含多个并排，含有相同内容的图片进行三等分
- 可选择提取左边、中间或右边部分
- 适用于批量提取能效标签等场景
- 输出到 `output_split/` 文件夹

## ✨ 主要功能

### 🎯 智能方向矫正

- 自动检测 0°、90°、180°、270° 四个方向
- 基于SSIM结构相似度算法精确匹配
- 支持批量处理
- 智能预警机制，避免误判

### ✂️ 白边智能裁剪

- 自动识别图片中的有效内容区域
- 裁剪周围的白色空白区域
- 可调节白色阈值和保留边距
- 批量处理整个文件夹

### 📐 内容分割提取

- 水平或垂直三等分图片
- 可选择只提取指定部分（左/中/右或上/中/下）
- 适合处理包含多个标签的图片
- 保持原文件名，方便管理

### ⚠️ 智能预警

- 自动识别相似度差异过小的图片
- 将可疑图片单独保存供人工检查
- 避免错误的自动矫正

### 📊 详细报告

- 显示每个角度的相似度分数
- 显示最佳角度与次佳角度的差异
- 完整的处理统计信息
- 实时显示处理进度

## 📁 文件说明

| 文件                            | 说明                       |
| ------------------------------- | -------------------------- |
| `image_rotation_corrector.py` | 图片方向自动矫正主程序     |
| `crop_white_edges.py`         | 裁剪白色边缘工具           |
| `split_images.py`             | 图片三等分提取工具         |
| `fix_manual_check.py`         | 修复人工检查图片的辅助脚本 |
| `requirements.txt`            | Python依赖库               |
| `使用说明.md`                 | 详细使用文档               |

## 📋 输出示例

### ✅ 功能一：方向矫正

```
[1/100] 处理: 1.png
  相似度分析:
      0°: 0.4766
      90°: 0.4352
     180°: 0.4779
   ★ 270°: 0.8956
  相似度差异: 0.4177 (阈值: 0.015)
  ✓ 已矫正: 旋转 270° (相似度: 0.8956)
  保存至: output\...
```

### ⚠️ 需要人工检查

```
[5/100] 处理: 5.png
  相似度分析:
      0°: 0.5424
      90°: 0.5236
     180°: 0.5426
   ★ 270°: 0.5469
  相似度差异: 0.0042 (阈值: 0.015)
  ⚠️  警告: 多个角度相似度接近，建议人工检查！
  ✓ 已矫正: 旋转 270° (相似度: 0.5469)
  保存至人工检查文件夹: output\manual_check\...
```

### ✂️ 功能二：白边裁剪

```
[1/100] 处理: 1.png
  原始尺寸: 3508 × 2480
  内容区域: [120:3388, 80:2400]
  裁剪后尺寸: 3268 × 2320
  内容占比: 87.3%
  ✓ 保存至: output_cropped\...
```

### 📐 功能三：三等分提取

```
[1/100] 处理: 1.png
  原始尺寸: 3508 × 915
  提取第 2 部分（中）: [1169, 0, 2339, 915]
  提取尺寸: 1170 × 915
  ✓ 保存至: output_extracted\...
```

## 🔧 高级配置

### 功能一：方向矫正配置

#### 调整相似度阈值

编辑 `image_rotation_corrector.py` 第19行：

```python
SIMILARITY_THRESHOLD = 0.015  # 默认1.5%
```

- **增大阈值**（如 0.02）：更严格，标记更多图片需要人工检查
- **减小阈值**（如 0.01）：更宽松，自动处理更多图片

#### 更改参考图片和路径

编辑 `image_rotation_corrector.py` 的 `main()` 函数：

```python
reference_image = "你的参考图片路径"
input_folder = "输入文件夹"
output_folder = "输出文件夹"
```

### 功能二：白边裁剪配置

编辑 `crop_white_edges.py` 的 `main()` 函数：

```python
batch_crop_white_edges(
    input_folder="output",        # 输入文件夹
    output_folder="output_cropped",  # 输出文件夹
    threshold=250,  # 白色阈值（0-255），越大越严格
    padding=10      # 保留边距（像素）
)
```

**参数说明：**

- `threshold`：白色阈值（0-255），像素值大于此值被视为白色
  - 默认 250：只裁剪纯白色
  - 降低到 240：也会裁剪浅灰色边缘
- `padding`：裁剪后保留的边距，避免内容被裁得太紧

### 功能三：三等分提取配置

编辑 `split_images.py` 的 `main()` 函数：

```python
batch_extract_part(
    input_folder="abnormal",          # 输入文件夹
    output_folder="output_extracted", # 输出文件夹
    part_index=2,                     # 1=左边, 2=中间, 3=右边
    direction='horizontal'            # 'horizontal' 或 'vertical'
)
```

**参数说明：**

- `part_index`：选择要提取的部分
  - 水平方向：1=左边, 2=中间, 3=右边
  - 垂直方向：1=上边, 2=中间, 3=下边
- `direction`：分割方向
  - `'horizontal'`：水平三等分（适合并排的标签）
  - `'vertical'`：垂直三等分（适合上下排列的内容）

### 通用问题

**Q: 支持哪些图片格式？**
A: 所有工具均支持 PNG、JPG、JPEG 格式。

**Q: 可以处理中文文件名吗？**
A: 可以，所有工具都完美支持中文路径和文件名。

## 📄 许可证

本项目仅供学习和研究使用。

---

**版本**: v3.0
**更新日期**: 2025-10
**支持**: Windows / macOS / Linux
**功能**: 方向矫正 + 白边裁剪 + 三等分提取
